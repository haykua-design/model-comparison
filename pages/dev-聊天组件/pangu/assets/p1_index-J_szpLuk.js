import{t as v,g as j,r as d,j as e}from"./vendor-CMcXz8NY.js";import{T as c}from"./index-BSC-yHEg.js";function i(...t){return v(j(t))}const y=({msg:t})=>{const l=t.sender==="user";return t.sender,e.jsxs("div",{className:i("flex items-start gap-3 mb-4",l?"justify-end":"justify-start"),children:[!l&&e.jsx("img",{src:t.avatar,alt:"Avatar",className:"w-10 h-10 rounded-full object-cover border border-slate-200"}),e.jsxs("div",{className:i("max-w-[80%] p-3 rounded-2xl relative",l?"bg-blue-500 text-white rounded-tr-none":"bg-white text-slate-900 rounded-tl-none border border-slate-100 shadow-sm"),children:[t.type==="text"&&e.jsx("p",{className:i(c.typography.body,"whitespace-pre-wrap"),children:t.content}),t.type==="image"&&e.jsx("div",{className:"rounded-lg overflow-hidden border border-slate-200 bg-slate-50",children:e.jsx("img",{src:t.content,alt:"Message Image",className:"w-full h-auto rounded-lg"})}),t.type==="code"&&e.jsx("pre",{className:"bg-slate-900 text-slate-50 p-3 rounded-lg overflow-x-auto text-xs font-mono",children:e.jsx("code",{children:t.content})}),e.jsx("div",{className:i("absolute bottom-1 right-1 text-[10px] opacity-70",l?"text-blue-400":"text-slate-400"),children:new Date(t.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),l&&e.jsx("img",{src:t.avatar,alt:"Avatar",className:"w-10 h-10 rounded-full object-cover border border-blue-200"})]})},w=({messages:t,onLoadMore:l})=>{const a=d.useRef(null),[m,p]=d.useState(!0),x=d.useCallback(()=>{a.current&&(a.current.scrollTop=a.current.scrollHeight)},[]);d.useEffect(()=>{x()},[t,x]);const h=()=>{if(a.current){const{scrollTop:n,scrollHeight:u,clientHeight:r}=a.current;p(u-n===r)}};return e.jsxs("div",{ref:a,onScroll:h,className:"flex-1 overflow-y-auto py-4 px-2 space-y-4",children:[e.jsx("div",{className:"flex flex-col gap-4",children:t.map(n=>e.jsx(y,{msg:n},n.id))}),!m&&e.jsx("div",{className:"absolute bottom-4 right-4 animate-pulse",children:e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"})}),e.jsx("div",{className:"h-10 flex items-center justify-center",children:e.jsx("div",{ref:n=>{n&&new IntersectionObserver(r=>{r[0].isIntersecting&&l()}).observe(n)},children:e.jsx("div",{className:"text-xs text-slate-400",children:"加载更多历史消息..."})})})]})},N=({onSend:t,users:l})=>{const[a,m]=d.useState(""),[p,x]=d.useState(!1),h=d.useRef(null),n=s=>{if(s.key==="Enter"){if(s.shiftKey)return;s.preventDefault(),a.trim()&&(t(a),m(""))}},u=s=>{const o=s.clipboardData.items;for(const g of o)if(g.type.indexOf("image")!==-1){const f=g.getAsFile();if(f){const b=new FileReader;b.onload=()=>{b.result&&t(b.result)},b.readAsDataURL(f),s.preventDefault()}}},r=s=>{const o=s.target.value;m(o),x(o.includes("@"))};return e.jsxs("div",{className:"mt-4 p-4 rounded-2xl border border-slate-200 bg-white shadow-sm relative",children:[e.jsx("textarea",{ref:h,value:a,onChange:r,onKeyDown:n,onPaste:u,placeholder:"输入消息...",className:i("w-full resize-none border-none outline-none focus:ring-0 bg-transparent",c.typography.body),rows:1}),p&&l&&e.jsx("div",{className:"absolute bottom-full mb-2 left-0 right-0 bg-white border border-slate-200 rounded-lg shadow-lg p-2 max-h-48 overflow-y-auto z-50",children:l.slice(0,5).map(s=>e.jsxs("div",{onClick:()=>{m(a+` @${s.name} `),x(!1),h.current?.focus()},className:"flex items-center gap-2 p-2 hover:bg-slate-50 cursor-pointer rounded-md",children:[e.jsx("img",{src:s.avatar,className:"w-6 h-6 rounded-full"}),e.jsx("span",{className:"text-sm font-medium",children:s.name})]},s.id))}),e.jsx("button",{onClick:()=>a.trim()&&t(a),className:i("mt-2 px-4 py-1.5 rounded-full text-white font-medium transition-all",a.trim()?"bg-blue-500 hover:bg-blue-600 shadow-md hover:shadow-lg":"bg-slate-200 cursor-not-allowed"),children:"发送"})]})};function S({initialMessages:t=[],onSend:l,users:a}){const[m,p]=d.useState(t),[x,h]=d.useState([]),n=r=>{const s={id:Math.random().toString(36).substr(2,9),content:r,type:r.startsWith("http")&&(r.endsWith(".png")||r.endsWith(".jpg")||r.endsWith(".jpeg"))?"image":"text",sender:"user",timestamp:Date.now(),avatar:"./assets/avatar-felix.svg"};p(o=>[...o,s]),l?.(r)},u=()=>{const r=Array.from({length:5},(s,o)=>({id:`hist-${o}`,content:`这是第 ${o+1} 条历史消息。`,type:"text",sender:"bot",timestamp:Date.now()-(o+1)*6e4,avatar:"./assets/avatar-bot.svg"}));h(s=>[...r,...s])};return e.jsxs("div",{className:"flex flex-col h-[600px] max-w-2xl mx-auto w-full border border-slate-200 rounded-3xl overflow-hidden shadow-xl bg-white",children:[e.jsxs("div",{className:"p-4 border-b border-slate-100 flex items-center justify-between bg-slate-50/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:"./assets/avatar-chat.svg",className:"w-10 h-10 rounded-full"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-slate-900",children:"实时聊天组件"}),e.jsx("div",{className:"text-[10px] text-slate-400",children:"正在连接..."})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500 animate-pulse"})})]}),e.jsx(w,{messages:[...x,...m],onLoadMore:u}),e.jsx(N,{onSend:n,users:a})]})}const M=[{id:"1",name:"Alice",avatar:"./assets/avatar-alice.svg"},{id:"2",name:"Bob",avatar:"./assets/avatar-bob.svg"},{id:"3",name:"Charlie",avatar:"./assets/avatar-charlie.svg"}],I=[{id:"1",content:"你好！这是一个功能完整的实时聊天组件。",type:"text",sender:"bot",timestamp:Date.now()-1e4,avatar:"./assets/avatar-bot.svg"},{id:"2",content:"支持文字、图片和代码块。",type:"text",sender:"bot",timestamp:Date.now()-8e3,avatar:"./assets/avatar-bot.svg"}];function E(){return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("section",{id:"message-interface",className:"scroll-mt-24",children:[e.jsx("h1",{className:i(c.typography.title,"text-3xl mb-4"),children:"消息接口定义"}),e.jsx("div",{className:"bg-slate-900 rounded-2xl p-6 text-slate-300 font-mono text-sm overflow-x-auto",children:e.jsx("pre",{children:`export interface Message {
  id: string;
  content: string;
  type: 'text' | 'image' | 'code';
  sender: 'user' | 'bot';
  timestamp: number;
  avatar: string;
}

export interface ChatProps {
  initialMessages?: Message[];
  onSend?: (content: string) => void;
  users?: { id: string; name: string; avatar: string }[];
}`})})]}),e.jsxs("section",{id:"message-list",className:"scroll-mt-24",children:[e.jsx("h2",{className:i(c.typography.title,"text-2xl mb-4"),children:"消息列表实现"}),e.jsx("p",{className:c.typography.body+" mb-6",children:"消息列表支持三种消息类型：文字、图片和代码块。每条消息都带有时间戳和头像。 新消息会自动滚动到底部，加载历史消息时会保持当前的滚动位置。"})]}),e.jsxs("section",{id:"chat-input",className:"scroll-mt-24",children:[e.jsx("h2",{className:i(c.typography.title,"text-2xl mb-4"),children:"输入框功能"}),e.jsx("p",{className:c.typography.body+" mb-6",children:'输入框支持 Shift+Enter 换行，Enter 发送。同时实现了简单的 @ 提及自动补全功能。 你可以尝试输入 "@" 来查看预设的用户列表。'})]}),e.jsxs("section",{id:"scroll-behavior",className:"scroll-mt-24",children:[e.jsx("h2",{className:i(c.typography.title,"text-2xl mb-4"),children:"自动滚动与历史加载"}),e.jsx("p",{className:c.typography.body+" mb-6",children:"组件使用 Intersection Observer 来检测滚动位置，当用户滚动到顶部时会自动加载更多历史消息。 新消息到达时，列表会平滑地滚动到底部。"})]}),e.jsx("div",{className:"mt-12",children:e.jsx(S,{initialMessages:I,users:M,onSend:t=>console.log("Sending:",t)})})]})}export{E as default};
